<html><head><title>New-HardDisk - PowerCLI System.Collections.Hashtable.ModuleName Help Reference</title><meta name="description" content=" New-HardDisk" /><meta name="keywords" content="PowerCLI System.Collections.Hashtable.ModuleName Help Reference, New-HardDisk, New, HardDisk" /><link href="doc-style.css" type="text/css" rel="StyleSheet"></head><body><h2 class="title"><a class="title" href='index.html' target="_top">PowerCLI Reference</a></h2><h1>New-HardDisk</h1><h2>Synopsis</h2>This cmdlet creates a new hard disk on the specified location.<p class="table-title">Syntax</p>New-HardDisk [-AdvancedOption &lt;AdvancedOption[]&gt;] [[-Persistence] &lt;String&gt;] [-Controller &lt;ScsiController&gt;] [[-DiskType] &lt;DiskType&gt;] [-CapacityKB &lt;Int64&gt;] [-CapacityGB &lt;Decimal&gt;] [-Split] [-ThinProvisioned] [-StorageFormat &lt;VirtualDiskStorageFormat&gt;] [-DeviceName &lt;String&gt;] [-Datastore &lt;StorageResource&gt;] [-VM] &lt;VirtualMachine&gt; [-Server &lt;VIServer[]&gt;] [-WhatIf] [-Confirm] [&lt;CommonParameters&gt;]
<br/>
<br/>New-HardDisk [[-Persistence] &lt;String&gt;] [-Controller &lt;ScsiController&gt;] -DiskPath &lt;String&gt; [-VM] &lt;VirtualMachine&gt; [-Server &lt;VIServer[]&gt;] [-WhatIf] [-Confirm] [&lt;CommonParameters&gt;]
<br/>
<br/>New-HardDisk [-Controller &lt;ScsiController&gt;] -VDisk &lt;VDisk&gt; [-VM] &lt;VirtualMachine&gt; [-Server &lt;VIServer[]&gt;] [-WhatIf] [-Confirm] [&lt;CommonParameters&gt;]<p class="table-title">Related Commands</p><a href='https://vdc-repo.vmware.com/vmwb-repository/dcr-public/7837e367-fe26-4d85-bd03-84d88261642c/2bc2f4e0-41f5-48b1-929e-e1568a8fe070/doc/New-HardDisk.html'>Online version</a><br><a href='Copy-HardDisk.html'>Copy-HardDisk</a><br><a href='Get-HardDisk.html'>Get-HardDisk</a><br><a href='Remove-HardDisk.html'>Remove-HardDisk</a><br><a href='Set-HardDisk.html'>Set-HardDisk</a><br><a href='Move-HardDisk.html'>Move-HardDisk</a><br><p class="table-title">Detailed Description</p>This cmdlet creates a new hard disk on the specified virtual machine or datastore. When a new virtual disk with raw disk mapping (RDM) backing is created, the compatibility mode of &quot;virtual&quot; or &quot;physical&quot; must be specified using the DiskType parameter. In &quot;virtual&quot; compatibility mode, the disk can use the specified disk modes. In &quot;physical&quot; compatibility mode, the disk modes are ignored and commands are passed directly to the backing Logical Unit Number (LUN). If &quot;flat&quot; mode is set by the DiskType parameter, the virtual disk backing is pre-allocated. If the hard disk is attached to no virtual machine, the value of the DiskType parameter might be Unknown, which means that no type is specified. Use the Persistence parameter to make the disk Persistent (changes are immediately and permanently written to the disk), Nonpersistent (changes to the disk are discarded when you power off or reset the virtual machine), IndependentPersistent, IndependentNonPersistent, or Undoable.<p class="table-title">Parameters</p><table cellspacing="0"><tr><th>Name</th><th>Type</th><th>Description</th><th>Required?</td><th>Pipeline Input</th><th>Default Value</th></tr><tr class="r1"><td><a id="VM" name="VM"></a><strong>VM</strong></td><td><a href="VirtualMachine.html">VirtualMachine</a></td><td>Specifies the virtual machine to which you want to add the new disk. Passing multiple values to this parameter is obsolete.</td><td>true</td><td>true (ByValue)</td><tr class="r0"><td><a id="Persistence" name="Persistence"></a><strong>Persistence</strong></td><td>String</td><td>Specifies the disk persistence mode. The valid values are Persistent, NonPersistent, IndependentPersistent, IndependentNonPersistent, and Undoable. This parameter is supported only when the disk type is set to ?rawVirtual? or ?flat?. The &#39;NonPersistent&#39; and &#39;Undoable&#39; values are deprecated and scheduled for removal. Their usage is not recommended because they do not work with snapshots and are not supported on ESX 3.5 and later.</td><td>false</td><td>false</td><tr class="r1"><td><a id="DiskType" name="DiskType"></a><strong>DiskType</strong></td><td><a href="DiskType.html">DiskType</a></td><td>Specifies the type of file backing you want to use. The valid values are rawVirtual, rawPhysical, flat, and unknown. If the hard disk is attached to no virtual machine, the value of the DiskType parameter might be Unknown, which means that no type is specified.</td><td>false</td><td>false</td><tr class="r0"><td><a id="AdvancedOption" name="AdvancedOption"></a><strong>AdvancedOption</strong></td><td><a href="AdvancedOption.html">AdvancedOption</a>[]</td><td>Specifies advanced options for creating hard disks. Accepts only SdrsVMDiskAntiAffinityRule objects. You can define an anti-affinity SDRS rule for the disk by specifying a SdrsVMDiskAntiAffinityRule object to the AdvancedOption parameter and this will override any existing SdrsVMDiskAntiAffinityRule for the virtual machine.
<br/>
<br/>The SdrsVMDiskAntiAffinityRule defines a Storage DRS intra-VM anti-affinity rule (vm disk anti-affinity rule). It is only applicable when creating a virtual machine or hard disk on a datastore cluster. An instance of the object is created by invoking its constructor. There are two constructors - &quot;public SdrsVMDiskAntiAffinityRule(param string[] diskIdentifier)&quot; and &quot;public SdrsVMDiskAntiAffinityRule(param HardDisk[] disk)&quot;. For the first constructor, &quot;diskIdentifier&quot; can be either the disk key or the index of the disk in the disk array. The specified disks (and the disk to which the rule is applied) are placed in an anti-affinity rule on a DatastoreCluster. Only one such rule is supported per a virtual machine. You can pass the instance to the AdvancedOption parameter of the New-VM or New-HardDisk cmdlets.</td><td>false</td><td>false</td><tr class="r1"><td><a id="CapacityGB" name="CapacityGB"></a><strong>CapacityGB</strong></td><td>Decimal</td><td>Specifies the capacity of the new virtual disk in gigabytes (GB). You need to specify this parameter when you create hard disks of type Flat.</td><td>false</td><td>false</td><tr class="r0"><td><a id="CapacityKB" name="CapacityKB"></a><strong>CapacityKB</strong></td><td>Int64</td><td>This parameter is obsolete. Use CapacityGB instead.
<br/>Specifies the capacity of the new virtual disk in kilobytes (KB). You need to specify this parameter when you create hard disks of type Flat.</td><td>false</td><td>false</td><tr class="r1"><td><a id="Confirm" name="Confirm"></a><strong>Confirm</strong></td><td>SwitchParameter</td><td>If the value is $true, indicates that the cmdlet asks for confirmation before running. If the value is $false, the cmdlet runs without asking for user confirmation.</td><td>false</td><td>false</td><tr class="r0"><td><a id="Controller" name="Controller"></a><strong>Controller</strong></td><td><a href="ScsiController.html">ScsiController</a></td><td>Specifies a SCSI controller to which you want to attach the new hard disk.</td><td>false</td><td>false</td><tr class="r1"><td><a id="Datastore" name="Datastore"></a><strong>Datastore</strong></td><td><a href="StorageResource.html">StorageResource</a></td><td>Specifies the datastore where you want to place the new hard disk. If a DatastoreCluster object is passed to the Datastore parameter, the hard disk is added to the DatastoreCluster in an automated SDRS mode. You can define an anti-affinity SDRS rule for the disk by specifying an SdrsVMDiskAntiAffinityRule object to the AdvancedOption parameter and this will override any existing SdrsVMDiskAntiAffinityRule for the virtual machine.</td><td>false</td><td>false</td><tr class="r0"><td><a id="DeviceName" name="DeviceName"></a><strong>DeviceName</strong></td><td>String</td><td>Specifies the host-specific device the LUN is being accessed through. If the target LUN is not available on the host then it is empty. For example, this could happen if it has been masked out accidentally. Only supported when DiskType is set to ?rawVirtual? or ?rawPhysical?. The device name is visible in the vSphere Client through the new raw hard disk wizard or can be retrieved using PowerCLI views.</td><td>false</td><td>false</td><tr class="r1"><td><a id="DiskPath" name="DiskPath"></a><strong>DiskPath</strong></td><td>String</td><td>Specifies the path to the hard disk.</td><td>true</td><td>false</td><tr class="r0"><td><a id="Server" name="Server"></a><strong>Server</strong></td><td><a href="VIServer.html">VIServer</a>[]</td><td>Specifies the vCenter Server systems on which you want to run the cmdlet. If no value is passed to this parameter, the command runs on the default servers. For more information about default servers, see the description of Connect-VIServer.</td><td>false</td><td>false</td><tr class="r1"><td><a id="Split" name="Split"></a><strong>Split</strong></td><td>SwitchParameter</td><td>This parameter is deprecated and scheduled for removal. Use the StorageFormat instead. 
<br/>Specifies the type of the virtual disk file - split or monolithic. If the value is $true, the virtual disk is stored in multiple files, each 2GB. If the value is $false, the virtual disk is stored in a single file. This parameter is supported only if the DiskType parameter is set to ?flat?.</td><td>false</td><td>false</td><tr class="r0"><td><a id="StorageFormat" name="StorageFormat"></a><strong>StorageFormat</strong></td><td><a href="VirtualDiskStorageFormat.html">VirtualDiskStorageFormat</a></td><td>Specifies the storage format of the new hard disk. This parameter accepts Thin, Thick, and EagerZeroedThick values.</td><td>false</td><td>false</td><tr class="r1"><td><a id="ThinProvisioned" name="ThinProvisioned"></a><strong>ThinProvisioned</strong></td><td>SwitchParameter</td><td>This parameter is deprecated and scheduled for removal. Use the StorageFormat instead. 
<br/>Indicates to the underlying file system, that the virtual disk backing file should be allocated lazily (using thin provisioning). This parameter is only used for file systems that support configuring the provisioning policy on a per file basis, such as VMFS3. This parameter is supported only if the DiskType parameter is set to ?flat?.</td><td>false</td><td>false</td><tr class="r0"><td><a id="VDisk" name="VDisk"></a><strong>VDisk</strong></td><td>VDisk</td><td>Specifies the VDisk object you want to attach to the virtual machine.</td><td>true</td><td>true (ByValue)</td><tr class="r1"><td><a id="WhatIf" name="WhatIf"></a><strong>WhatIf</strong></td><td>SwitchParameter</td><td>Indicates that the cmdlet is run only to display the changes that would be made and actually no objects are modified.</td><td>false</td><td>false</td></table><p class="table-title">Return Type</p>The one or more newly created <a href="HardDisk.html">HardDisk</a> objects
<p class="table-title">Notes</p>Works only on ESXi hosts.
    New-HardDisk cannot create undoable disks on powered-on virtual machines.
    On ESX versions later than 3.0, non-persistent and undoable disks are not supported.<p class="table-title">Examples</p><div class="example"><p class="example-title">--------------  Example 1 --------------</p><pre class="programlisting">$vm = Get-VM VM

$vm | New-HardDisk -CapacityGB 100 -Persistence persistent</pre><p>Adds to the VM virtual machine a new hard disk in a persistent mode with capacity of 100 GB.</p><p class="example-title">--------------  Example 2 --------------</p><pre class="programlisting">$deviceName = ($vmhost | Get-ScsiLun | Where {$_.CanonicalName -match &quot;naa&quot;})[0].ConsoleDeviceName

New-HardDisk -VM $vm -DiskType RawPhysical -DeviceName $deviceName</pre><p>Obtains a valid device name for Raw Disk Mapping.  Then the command creates a RDM hard disk for the specified virtual machine, with the obtained device name.</p><p class="example-title">--------------  Example 3 --------------</p><pre class="programlisting">New-HardDisk -VM $vm -CapacityGB 100 -Persistence IndependentNonPersistent</pre><p>Creates a non-persistent hard disk with the specified capacity.</p><p class="example-title">--------------  Example 4 --------------</p><pre class="programlisting">New-HardDisk -VM $vm -DiskPath &quot;[storage1] OtherVM/OtherVM.vmdk&quot;</pre><p>Attaches an available disk from a *.vmdk file.</p><p class="example-title">--------------  Example 5 --------------</p><pre class="programlisting">$vm = Get-VM WebServerVM

$disk = $vm | Get-HardDisk

$antiAffinityRule = New-Object &#39;VMware.VimAutomation.ViCore.Types.V1.DatastoreManagement.SdrsVMDiskAntiAffinityRule&#39; $disk

New-HardDisk -VM $vm -AdvancedOption $antiAffinityRule -CapacityGB 40 -Datastore DatastoreCluster1</pre><p>First retrieves the existing disk which will be part of the VMDK anti-affinity rule. Then, creates an object describing the rule and creates the new hard disk.</p><p class="example-title">--------------  Example 6 --------------</p><pre class="programlisting">New-HardDisk -VM $vm -VDisk $vDisk</pre><p>Attaches the $vDisk VDisk object to the $vm virtual machine.</p></div><hr>Copyright &copy; VMware, Inc.&nbsp;All rights reserved.</body></html>
