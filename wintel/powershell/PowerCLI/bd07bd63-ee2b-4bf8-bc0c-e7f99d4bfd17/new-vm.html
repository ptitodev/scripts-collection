<html><head><title>New-VM - PowerCLI System.Collections.Hashtable.ModuleName Help Reference</title><meta name="description" content=" New-VM" /><meta name="keywords" content="PowerCLI System.Collections.Hashtable.ModuleName Help Reference, New-VM, New, VM" /><link href="doc-style.css" type="text/css" rel="StyleSheet"></head><body><h2 class="title"><a class="title" href='index.html' target="_top">PowerCLI Reference</a></h2><h1>New-VM</h1><h2>Synopsis</h2>This cmdlet creates a new virtual machine.<p class="table-title">Syntax</p>New-VM [-AdvancedOption &lt;AdvancedOption[]&gt;] [[-VMHost] &lt;VMHost&gt;] [-Version &lt;VMVersion&gt;] -Name &lt;String&gt; [-ResourcePool &lt;VIContainer&gt;] [-VApp &lt;VApp&gt;] [-Location &lt;Folder&gt;] [-Datastore &lt;StorageResource&gt;] [-DiskMB &lt;Int64[]&gt;] [-DiskGB &lt;Decimal[]&gt;] [-DiskPath &lt;String[]&gt;] [-DiskStorageFormat &lt;VirtualDiskStorageFormat&gt;] [-MemoryMB &lt;Int64&gt;] [-MemoryGB &lt;Decimal&gt;] [-NumCpu &lt;Int32&gt;] [-CoresPerSocket &lt;Int32&gt;] [-Floppy] [-CD] [-GuestId &lt;String&gt;] [-AlternateGuestName &lt;String&gt;] [-NetworkName &lt;String[]&gt;] [-Portgroup &lt;VirtualPortGroupBase[]&gt;] [-HARestartPriority &lt;HARestartPriority&gt;] [-HAIsolationResponse &lt;HAIsolationResponse&gt;] [-DrsAutomationLevel &lt;DrsAutomationLevel&gt;] [-VMSwapfilePolicy &lt;VMSwapfilePolicy&gt;] [-Server &lt;VIServer[]&gt;] [-RunAsync] [-Notes &lt;String&gt;] [-WhatIf] [-Confirm] [&lt;CommonParameters&gt;]
<br/>
<br/>New-VM [-AdvancedOption &lt;AdvancedOption[]&gt;] [[-VMHost] &lt;VMHost&gt;] [-Name &lt;String&gt;] [-ResourcePool &lt;VIContainer&gt;] [-VApp &lt;VApp&gt;] [-Location &lt;Folder&gt;] [-Datastore &lt;StorageResource&gt;] [-DiskStorageFormat &lt;VirtualDiskStorageFormat&gt;] [-OSCustomizationSpec &lt;OSCustomizationSpec&gt;] [-HARestartPriority &lt;HARestartPriority&gt;] [-HAIsolationResponse &lt;HAIsolationResponse&gt;] [-DrsAutomationLevel &lt;DrsAutomationLevel&gt;] [-LinkedClone] [-ReferenceSnapshot &lt;Snapshot&gt;] [-Server &lt;VIServer[]&gt;] [-RunAsync] [-Notes &lt;String&gt;] -VM &lt;VirtualMachine[]&gt; [-WhatIf] [-Confirm] [&lt;CommonParameters&gt;]
<br/>
<br/>New-VM [-AdvancedOption &lt;AdvancedOption[]&gt;] [[-VMHost] &lt;VMHost&gt;] -Name &lt;String&gt; [-ResourcePool &lt;VIContainer&gt;] [-VApp &lt;VApp&gt;] [-Location &lt;Folder&gt;] [-Datastore &lt;StorageResource&gt;] [-Template] &lt;Template&gt; [-DiskStorageFormat &lt;VirtualDiskStorageFormat&gt;] [-OSCustomizationSpec &lt;OSCustomizationSpec&gt;] [-HARestartPriority &lt;HARestartPriority&gt;] [-HAIsolationResponse &lt;HAIsolationResponse&gt;] [-DrsAutomationLevel &lt;DrsAutomationLevel&gt;] [-Server &lt;VIServer[]&gt;] [-RunAsync] [-Notes &lt;String&gt;] [-WhatIf] [-Confirm] [&lt;CommonParameters&gt;]
<br/>
<br/>New-VM [[-VMHost] &lt;VMHost&gt;] [-Name &lt;String&gt;] [-ResourcePool &lt;VIContainer&gt;] [-VApp &lt;VApp&gt;] [-Location &lt;Folder&gt;] [-HARestartPriority &lt;HARestartPriority&gt;] [-HAIsolationResponse &lt;HAIsolationResponse&gt;] [-DrsAutomationLevel &lt;DrsAutomationLevel&gt;] -VMFilePath &lt;String&gt; [-Server &lt;VIServer[]&gt;] [-RunAsync] [-Notes &lt;String&gt;] [-WhatIf] [-Confirm] [&lt;CommonParameters&gt;]
<br/>
<br/>New-VM [[-VMHost] &lt;VMHost&gt;] [-Name &lt;String&gt;] [-ResourcePool &lt;VIContainer&gt;] [-Location &lt;Folder&gt;] [-Datastore &lt;StorageResource&gt;] [-DiskStorageFormat &lt;VirtualDiskStorageFormat&gt;] [-HARestartPriority &lt;HARestartPriority&gt;] [-HAIsolationResponse &lt;HAIsolationResponse&gt;] [-DrsAutomationLevel &lt;DrsAutomationLevel&gt;] [-ContentLibraryItem] &lt;ContentLibraryItem&gt; [-Server &lt;VIServer[]&gt;] [-RunAsync] [-WhatIf] [-Confirm] [&lt;CommonParameters&gt;]<p class="table-title">Related Commands</p><a href='https://vdc-repo.vmware.com/vmwb-repository/dcr-public/7837e367-fe26-4d85-bd03-84d88261642c/2bc2f4e0-41f5-48b1-929e-e1568a8fe070/doc/New-VM.html'>Online version</a><br><a href='Get-VM.html'>Get-VM</a><br><a href='Move-VM.html'>Move-VM</a><br><a href='Remove-VM.html'>Remove-VM</a><br><a href='Set-VM.html'>Set-VM</a><br><a href='Start-VM.html'>Start-VM</a><br><a href='Stop-VM.html'>Stop-VM</a><br><a href='Suspend-VM.html'>Suspend-VM</a><br><a href='Restart-VM.html'>Restart-VM</a><br><p class="table-title">Detailed Description</p>This cmdlet creates a new virtual machine with the provided parameters. The network adapter and the SCSI adapter of the new virtual machine are created of the recommended type for the OS that is specified by the GuestId parameter. If  the OSCustomizationSpec parameter is used,  the virtual machine is customized according to the spec. You must specify values for at least one of the ResourcePool, VMHost, and VApp parameters.<p class="table-title">Parameters</p><table cellspacing="0"><tr><th>Name</th><th>Type</th><th>Description</th><th>Required?</td><th>Pipeline Input</th><th>Default Value</th></tr><tr class="r1"><td><a id="VMHost" name="VMHost"></a><strong>VMHost</strong></td><td><a href="VMHost.html">VMHost</a></td><td>Specifies the host on which you want to create the new virtual machine.</td><td>false</td><td>true (ByValue)</td><tr class="r0"><td><a id="ContentLibraryItem" name="ContentLibraryItem"></a><strong>ContentLibraryItem</strong></td><td><a href="ContentLibraryItem.html">ContentLibraryItem</a></td><td>Specifies the content library template to deploy the virtual machine from.</td><td>true</td><td>true (ByValue)</td><tr class="r1"><td><a id="Template" name="Template"></a><strong>Template</strong></td><td><a href="Template.html">Template</a></td><td>Specifies the virtual machine template you want to use for the creation of the new virtual machine. Passing values to this parameter through a pipeline is deprecated and will be disabled in a future release.</td><td>true</td><td>true (ByValue)</td><tr class="r0"><td><a id="AdvancedOption" name="AdvancedOption"></a><strong>AdvancedOption</strong></td><td><a href="AdvancedOption.html">AdvancedOption</a>[]</td><td>Specifies advanced options for creating virtual machines. Accepts only SdrsVMDiskAntiAffinityRule and SdrsVMAntiAffinityRule objects.
<br/>
<br/>The SdrsVMDiskAntiAffinityRule defines a Storage DRS intra-VM anti-affinity rule (vm disk anti-affinity rule). It is only applicable when creating a virtual machine or hard disk on a datastore cluster. An instance of the object is created by invoking its constructor. There are two constructors - &quot;public SdrsVMDiskAntiAffinityRule(param string[] diskIdentifier)&quot; and &quot;public SdrsVMDiskAntiAffinityRule(param HardDisk[] disk)&quot;. For the first constructor, &quot;diskIdentifier&quot; can be either the disk key or the index of the disk in the disk array. The specified disks (and the disk to which the rule is applied) are placed in an anti-affinity rule on a DatastoreCluster. Only one such rule is supported per a virtual machine. You can pass the instance to the AdvancedOption parameter of the New-VM or New-HardDisk cmdlets.
<br/>
<br/>The SdrsVMAntiAffinityRule defines a Storage DRS inter-VM anti-affinity rule. It is only applicable when creating a virtual machine on a DatastoreCluster. An instance of the object is created by invoking its constructor. The constructor has one parameter - an array of virtual machines - &quot;public SdrsVMAntiAffinityRule(param VirtualMachine[] vm)&quot;. Then, you can pass the instance to the AdvancedOption parameter of the New-VM cmdlet. This will place the new virtual machine and the virtual machines specified in the constructor in an inter-VM anti-affinity rule on a DatastoreCluster.</td><td>false</td><td>false</td><tr class="r1"><td><a id="AlternateGuestName" name="AlternateGuestName"></a><strong>AlternateGuestName</strong></td><td>String</td><td>Specifies the full OS name of the new virtual machine. Use this parameter if the GuestID parameter is set to otherGuest or otherGuest64.</td><td>false</td><td>false</td><tr class="r0"><td><a id="CD" name="CD"></a><strong>CD</strong></td><td>SwitchParameter</td><td>Indicates that you want to add a CD drive to the new virtual machine.</td><td>false</td><td>false</td><tr class="r1"><td><a id="Confirm" name="Confirm"></a><strong>Confirm</strong></td><td>SwitchParameter</td><td>If the value is $true, indicates that the cmdlet asks for confirmation before running. If the value is $false, the cmdlet runs without asking for user confirmation.</td><td>false</td><td>false</td><tr class="r0"><td><a id="CoresPerSocket" name="CoresPerSocket"></a><strong>CoresPerSocket</strong></td><td>Int32</td><td>Specifies the number of virtual CPU cores per socket.</td><td>false</td><td>false</td><tr class="r1"><td><a id="Datastore" name="Datastore"></a><strong>Datastore</strong></td><td><a href="StorageResource.html">StorageResource</a></td><td>Specifies the datastore where you want to place the new virtual machine. If a DatastoreCluster is passed to the Datastore parameter, the virtual machine is placed in the DatastoreCluster in an automated SDRS mode and with enabled intra-VM affinity rule (unless another rule is specified). You can specify a SDRS rule when creating the virtual machine in a DatastoreCluster by passing either a SdrsVMDiskAntiAffinityRule or SdrsVMAntiAffinityRule objects to the AdvancedOption parameter. These two rules are mutually exclusive.</td><td>false</td><td>false</td><tr class="r0"><td><a id="DiskGB" name="DiskGB"></a><strong>DiskGB</strong></td><td>Decimal[]</td><td>Specifies the size in gigabytes (GB) of the disks that you want to create and add to the new virtual machine.</td><td>false</td><td>false</td><tr class="r1"><td><a id="DiskMB" name="DiskMB"></a><strong>DiskMB</strong></td><td>Int64[]</td><td>This parameter is obsolete. Use DiskGB instead.
<br/>Specifies the size in megabytes (MB) of the disks that you want to create and add to the new virtual machine.</td><td>false</td><td>false</td><tr class="r0"><td><a id="DiskPath" name="DiskPath"></a><strong>DiskPath</strong></td><td>String[]</td><td>Specifies paths to virtual disks you want to add to the new virtual machine.</td><td>false</td><td>false</td><tr class="r1"><td><a id="DiskStorageFormat" name="DiskStorageFormat"></a><strong>DiskStorageFormat</strong></td><td><a href="VirtualDiskStorageFormat.html">VirtualDiskStorageFormat</a></td><td>Specifies the storage format of the disks of the virtual machine. This parameter accepts Thin, Thick, and EagerZeroedThick values.</td><td>false</td><td>false</td><tr class="r0"><td><a id="DrsAutomationLevel" name="DrsAutomationLevel"></a><strong>DrsAutomationLevel</strong></td><td><a href="DrsAutomationLevel.html">DrsAutomationLevel</a></td><td>Specifies a DRS (Distributed Resource Scheduler) automation level. The valid values are FullyAutomated, Manual, PartiallyAutomated, AsSpecifiedByCluster, and Disabled. Passing values to this parameter through a pipeline is deprecated and will be disabled in a future release. Specifying this parameter is only supported when the virtual machine is inside a cluster. Otherwise, an error is generated.</td><td>false</td><td>false</td><tr class="r1"><td><a id="Floppy" name="Floppy"></a><strong>Floppy</strong></td><td>SwitchParameter</td><td>Indicates that you want to add a floppy drive to the new virtual machine.</td><td>false</td><td>false</td><tr class="r0"><td><a id="GuestId" name="GuestId"></a><strong>GuestId</strong></td><td>String</td><td>Specifies the guest operating system of the new virtual machine. The valid values for specific ESX versions are listed in the description of the VirtualMachineGuestOsIdentifier enumeration type in the vSphere API Reference available at http://www.vmware.com/support/developer/vc-sdk/. Depending on the hardware configuration of the host, some of the guest operating systems might be inapplicable.</td><td>false</td><td>false</td><tr class="r1"><td><a id="HAIsolationResponse" name="HAIsolationResponse"></a><strong>HAIsolationResponse</strong></td><td><a href="HAIsolationResponse.html">HAIsolationResponse</a></td><td>Indicates whether the virtual machine should be powered off if a host determines that it is isolated from the rest of the compute resource. The available values are AsSpecifiedByCluster, PowerOff, and DoNothing. Passing values to this parameter through a pipeline is deprecated and will be disabled in a future release. Specifying this parameter is only supported when the virtual machine is inside a cluster. Otherwise, an error is generated.</td><td>false</td><td>false</td><tr class="r0"><td><a id="HARestartPriority" name="HARestartPriority"></a><strong>HARestartPriority</strong></td><td><a href="HARestartPriority.html">HARestartPriority</a></td><td>Specifies the HA restart priority of the new virtual machine. The valid values are Disabled, Low, Medium, High, and ClusterRestartPriority. VMware HA is a feature that detects failed virtual machines and automatically restarts them on alternative ESX hosts. Passing values to this parameter through a pipeline is deprecated and will be disabled in a future release. Specifiesing this parameter is only supported when the virtual machine is inside a cluster. Otherwise, an error is generated.</td><td>false</td><td>false</td><tr class="r1"><td><a id="LinkedClone" name="LinkedClone"></a><strong>LinkedClone</strong></td><td>SwitchParameter</td><td>Indicates that you want to create a linked clone. When you set the LinkedClone parameter, the ReferenceSnapshot parameter becomes mandatory.</td><td>false</td><td>false</td><tr class="r0"><td><a id="Location" name="Location"></a><strong>Location</strong></td><td><a href="Folder.html">Folder</a></td><td>Specifies the folder where you want to place the new virtual machine.</td><td>false</td><td>false</td><tr class="r1"><td><a id="MemoryGB" name="MemoryGB"></a><strong>MemoryGB</strong></td><td>Decimal</td><td>Specifies the memory size in gigabytes (GB) of the new virtual machine.</td><td>false</td><td>false</td><tr class="r0"><td><a id="MemoryMB" name="MemoryMB"></a><strong>MemoryMB</strong></td><td>Int64</td><td>This parameter is obsolete. Use MemoryGB instead.
<br/>Specifies the memory size in megabytes (MB) of the new virtual machine.</td><td>false</td><td>false</td><tr class="r1"><td><a id="Name" name="Name"></a><strong>Name</strong></td><td>String</td><td>Specifies a name for the new virtual machine. If you are registering or cloning an existing virtual machine, this parameter is not mandatory.</td><td>true</td><td>false</td><tr class="r0"><td><a id="NetworkName" name="NetworkName"></a><strong>NetworkName</strong></td><td>String[]</td><td>Specifies the networks to which you want to connect the new virtual machine. Specifying a distributed port group name is obsolete. Use the Portgroup parameter instead.</td><td>false</td><td>false</td><tr class="r1"><td><a id="Notes" name="Notes"></a><strong>Notes</strong></td><td>String</td><td>Provides a description of the new virtual machine. The alias of this parameter is Description.</td><td>false</td><td>false</td><tr class="r0"><td><a id="NumCpu" name="NumCpu"></a><strong>NumCpu</strong></td><td>Int32</td><td>Specifies the number of the virtual CPUs of the new virtual machine.</td><td>false</td><td>false</td><tr class="r1"><td><a id="OSCustomizationSpec" name="OSCustomizationSpec"></a><strong>OSCustomizationSpec</strong></td><td><a href="OSCustomizationSpec.html">OSCustomizationSpec</a></td><td>Specifies a customization specification that is to be applied to the new virtual machine.</td><td>false</td><td>false</td><tr class="r0"><td><a id="Portgroup" name="Portgroup"></a><strong>Portgroup</strong></td><td><a href="VirtualPortGroupBase.html">VirtualPortGroupBase</a>[]</td><td>Specifies standard or distributed port groups to which you want to connect the virtual machine. For each specified port group, a new network adapter is created.</td><td>false</td><td>false</td><tr class="r1"><td><a id="ReferenceSnapshot" name="ReferenceSnapshot"></a><strong>ReferenceSnapshot</strong></td><td><a href="Snapshot.html">Snapshot</a></td><td>Specifies a source snapshot for the linked clone that you want to create. When you set the LinkedClone parameter, the ReferenceSnapshot parameter becomes mandatory.</td><td>false</td><td>false</td><tr class="r0"><td><a id="ResourcePool" name="ResourcePool"></a><strong>ResourcePool</strong></td><td><a href="VIContainer.html">VIContainer</a></td><td>Specifies where you want to place the new virtual machine. The parameter accepts VMHost, Cluster, ResourcePool, and VApp objects. If no value is specified, the virtual machine is added to the resource pool of its host.</td><td>false</td><td>true (ByValue)</td><tr class="r1"><td><a id="RunAsync" name="RunAsync"></a><strong>RunAsync</strong></td><td>SwitchParameter</td><td>Indicates that the command returns immediately without waiting for the task to complete. In this mode, the output of the cmdlet is a Task object. For more information about the RunAsync parameter run &quot;help About_RunAsync&quot; in the VMware PowerCLI console.</td><td>false</td><td>false</td><tr class="r0"><td><a id="Server" name="Server"></a><strong>Server</strong></td><td><a href="VIServer.html">VIServer</a>[]</td><td>Specifies the vCenter Server systems on which you want to run the cmdlet. If no value is passed to this parameter, the command runs on the default servers. For more information about default servers, see the description of Connect-VIServer.</td><td>false</td><td>false</td><tr class="r1"><td><a id="VApp" name="VApp"></a><strong>VApp</strong></td><td><a href="VApp.html">VApp</a></td><td>This parameter is deprecated. Use the ResourcePool parameter instead.
<br/>Specifies the vApp where you want to create the new virtual machine.</td><td>false</td><td>true (ByValue)</td><tr class="r0"><td><a id="Version" name="Version"></a><strong>Version</strong></td><td><a href="VMVersion.html">VMVersion</a></td><td>Specifies the version of the new virtual machine. The valid values are v4, v7, v8, v9, v10, and v11. By default, the new virtual machine is created with the latest available version.</td><td>false</td><td>false</td><tr class="r1"><td><a id="VM" name="VM"></a><strong>VM</strong></td><td><a href="VirtualMachine.html">VirtualMachine</a>[]</td><td>Specifies a virtual machine to clone.</td><td>true</td><td>true (ByValue)</td><tr class="r0"><td><a id="VMFilePath" name="VMFilePath"></a><strong>VMFilePath</strong></td><td>String</td><td>Specifies a path to the virtual machine you want to register.</td><td>true</td><td>false</td><tr class="r1"><td><a id="VMSwapfilePolicy" name="VMSwapfilePolicy"></a><strong>VMSwapfilePolicy</strong></td><td><a href="VMSwapfilePolicy.html">VMSwapfilePolicy</a></td><td>Specifies the swapfile placement policy. The following values are valid:
<br/>
<br/>InHostDataStore - Stores the swapfile in the datastore specified by the VMSwapfileDatastoreID property of the virtual machine host. If the VMSwapfileDatastoreID property is not set or indicates a datastore with insufficient free space, the swapfile is stored in the same directory as the virtual machine. This setting might degrade the VMotion performance.
<br/>
<br/>WithVM - Stores the swapfile in the same directory as the virtual machine.</td><td>false</td><td>false</td><tr class="r0"><td><a id="WhatIf" name="WhatIf"></a><strong>WhatIf</strong></td><td>SwitchParameter</td><td>Indicates that the cmdlet is run only to display the changes that would be made and actually no objects are modified.</td><td>false</td><td>false</td></table><p class="table-title">Return Type</p>The newly created <a href="VirtualMachine.html">VirtualMachine</a> object
<p class="table-title">Notes</p><p class="table-title">Examples</p><div class="example"><p class="example-title">--------------  Example 1 --------------</p><pre class="programlisting">$myTargetVMHost = Get-VMHost -Name MyVMHost1
New-VM -Name MyVM1 -ResourcePool $myTargetVMHost -Datastore MyDatastore1 -NumCPU 2 -MemoryGB 4 -DiskGB 40 -NetworkName &quot;VM Network&quot; -Floppy -CD -DiskStorageFormat Thin -GuestID winNetDatacenterGuest</pre><p>Creates a virtual machine by specifying a target host, a target datastore, and a network to connect to, and configures the settings for the virtual machine.</p><p class="example-title">--------------  Example 2 --------------</p><pre class="programlisting">$myCluster = Get-Cluster -Name MyCluster1
New-VM -Name MyVM1 -ResourcePool $myCluster</pre><p>Creates a virtual machine by specifying a cluster. The ResourcePool parameter accepts ResourcePool, Cluster, VApp, and standalone VMHost objects.</p><p class="example-title">--------------  Example 3 --------------</p><pre class="programlisting">$vmhost = Get-VMHost -Name MyVMHost1
$myCluster = Get-Cluster -Name MyCluster1
New-VM -Name MyVM1 -VMHost $vmhost -ResourcePool $myCluster -DiskGB 4 -MemoryGB 1</pre><p>Creates a virtual machine by specifying a cluster and explicitly selecting the host, instead of allowing auto-selection of a target host.</p><p class="example-title">--------------  Example 4 --------------</p><pre class="programlisting">$vmhost = Get-VMHost -Name MyVMHost1
New-VM -Name MyVM1 -ResourePool $vmhost -DiskGB 40,100</pre><p>Creates a virtual machine with multiple disks.</p><p class="example-title">--------------  Example 5 --------------</p><pre class="programlisting">$vmhost = Get-VMHost -Name MyVMHost1
New-VM -Name MyVM1 -ResourcePool $vmhost -DiskPath &quot;[Storage1] WindowsXP/WindowsXP.vmdk&quot;</pre><p>Creates a virtual machine by specifying an existing disk.</p><p class="example-title">--------------  Example 6 --------------</p><pre class="programlisting">$vmhost = Get-VMHost -Name MyVMHost1
New-VM -Name MyVM1 -ResourcePool $vmhost -Version v4</pre><p>Creates a virtual machine by explicitly specifying the version of the virtual machine hardware through the Version parameter.</p><p class="example-title">--------------  Example 7 --------------</p><pre class="programlisting">$myDatastore = Get-Datastore -Name MyDatastore1
$vmhost = Get-VMHost -Name MyVMHost1
New-VM -Name MyVM2 -VM MyVM1 -Datastore $myDatastore -VMHost $vmhost</pre><p>Creates a new virtual machine named MyVM2 by cloning the MyVM1 virtual machine on the specified datastore and host.</p><p class="example-title">--------------  Example 8 --------------</p><pre class="programlisting">New-VM -VM MyVM1, MyVM2 -Location MyFolder1 -VMHost MyHost1</pre><p>Copies the MyVM1 and MyVM2 virtual machines to the MyFolder1 folder on the MyHost1 host.</p><p class="example-title">--------------  Example 9 --------------</p><pre class="programlisting">$myResourcePool = Get-ResourcePool -Name MyResourcePool1
$mySpecification = Get-OSCustomizationSpec -Name WindowsSpec
New-VM -VM MyVM1 -Name MyVM2 -OSCustomizationSpec $mySpecification -ResourcePool $myResourcePool</pre><p>Clones the virtual machine MyVM1 to MyVM2 and applies a customization specification on the cloned virtual machine.</p><p class="example-title">--------------  Example 10 --------------</p><pre class="programlisting">$myResourcePool = Get-ResourcePool -Name MyResourcePool1
$myTemplate = Get-Template -Name WindowsTemplate
$mySpecification = Get-OSCustomizationSpec -Name WindowsSpec
New-VM -Name MyVM2 -Template $myTemplate -ResourcePool $myResourcePool -OSCustomizationSpec $mySpecification</pre><p>Creates a virtual machine from the specified template and applies the specified customization specification.</p><p class="example-title">--------------  Example 11 --------------</p><pre class="programlisting">cd vmstores:\myserver@443\Datacenter\Storage1\MyVM1\
$vmxFile = Get-Item MyVM1.vmx
$vmhost = Get-VMHost -Name MyVMHost1
New-VM -VMHost $vmhost -VMFilePath $vmxFile.DatastoreFullPath</pre><p>Retrieves the specified configuration file for the MyVM1 virtual machine and registers the MyVM1 virtual machine on the specified host.</p><p class="example-title">--------------  Example 12 --------------</p><pre class="programlisting">$vmhost = Get-VMHost -Name MyVMHost1
$myDatastoreCluster = Get-DatastoreCluster -Name MyStorageCluster1
New-VM -Name MyVM1 -DiskGB 40,40 -Datastore $myDatastoreCluster -ResourcePool $vmhost</pre><p>Creates a virtual machine on a datastore cluster. By default, the new virtual machine has an intra-VM affinity rule.</p><p class="example-title">--------------  Example 13 --------------</p><pre class="programlisting">$vmhost = Get-VMHost -Name MyVMHost1
$myDatastoreCluster = Get-DatastoreCluster -Name MyStorageCluster1
$myAdvancedOption = New-Object &#39;VMware.VimAutomation.ViCore.Types.V1.DatastoreManagement.SdrsVMDiskAntiAffinityRule&#39; 1,2
New-VM -Name MyVM1 -DiskGB 40,40,40 -Datastore $myDatastoreCluster -AdvancedOption $myAdvancedOption -ResourcePool $vmhost</pre><p>Creates a virtual machine on a datastore cluster. The machine has three hard disks.  For the first two disks, intra-VM anti-affinity rule is specified and they will be placed on a datastore different from the datastore cluster. Identifying the hard disk in the Intra-VM anti-affinity happens by indexing the disks starting from 1.</p><p class="example-title">--------------  Example 14 --------------</p><pre class="programlisting">$myVM1 = Get-VM -Name WindowsXP
$myResourcePool = Get-ResourcePool -Name MyResourcePool1
$myAdvancedOption = New-Object &#39;VMware.VimAutomation.ViCore.Types.V1.DatastoreManagement.SdrsVMAntiAffinityRule&#39; $myVM1
$myDatastoreCluster = Get-DatastoreCluster -Name MyStorageCluster1
New-VM -Name MyVM1 -DiskGB 40,40,40 -Datastore $myDatastoreCluster -AdvancedOption $myAdvancedOption -ResourcePool $myResourcePool</pre><p>Creates a virtual machine on a datastore cluster and specifies a VM anti-affinity rule between the new virtual machine and an existing virtual machine.</p><p class="example-title">--------------  Example 15 --------------</p><pre class="programlisting">$mySourceVM = Get-VM -Name MySourceVM1
$vmhost = Get-VMHost -Name MyVMHost1
$hardDiskList = Get-HardDisk -VM $vm | select -First 2
$myDatastoreCluster = Get-DatastoreCluster -Name MyStorageCluster1
$myAdvancedOption = New-Object &#39;VMware.VimAutomation.ViCore.Types.V1.DatastoreManagement.SdrsVMDiskAntiAffinityRule&#39; $hardDiskList
New-VM -Name MyVM1 -VM $mySourceVM -Datastore $myDatastoreCluster -AdvancedOption $myAdvancedOption -ResourcePool $vmhost</pre><p>Clones a virtual machine on a datastore cluster and specifies an intra-VM anti-affinity rule by using references to the hard disks of the source virtual machine. When you apply this rule to the AdvancedOption parameter of New-VM, the first and second disk of the new virtual machine will be placed on different datastores within the specified datastore cluster.</p><p class="example-title">--------------  Example 16 --------------</p><pre class="programlisting">$mySourceVM = Get-VM -Name MySourceVM1
$myVM1 = Get-VM -Name WindowsXP
$myAdvancedOption = New-Object &#39;VMware.VimAutomation.ViCore.Types.V1.DatastoreManagement.SdrsVMAntiAffinityRule&#39; $myVM1
$myDatastoreCluster = Get-DatastoreCluster -Name MyStorageCluster1
$vmhost = Get-VMHost -Name MyVMHost1
New-VM -Name MyVM2 -VM $mySourceVM -Datastore $myDatastoreCluster -AdvancedOption $myAdvancedOption -ResourcePool $vmhost</pre><p>Clones a virtual machine on a datastore cluster and specifies a VM anti-afffinity rule between the new virtual machine and an existing virtual machine. When you apply this rule to the AdvancedOption parameter of New-VM, the new virtual machine and the WindowsXP virtual machine will be placed on different datastores within the specified datastore cluster.</p><p class="example-title">--------------  Example 17 --------------</p><pre class="programlisting">$mySourceTemplate = Get-Template -Name WindowsTemplate
$myDatastoreCluster = Get-DatastoreCluster -Name MyStorageCluster
$myAdvancedOption = New-Object &#39;VMware.VimAutomation.ViCore.Types.V1.DatastoreManagement.SdrsVMDiskAntiAffinityRule&#39; $hardDiskList
$vmhost = Get-VMHost -Name MyVMHost1
New-VM -Name MyVM1 -Template $mySourceTemplate -Datastore $myDatastoreCluster -AdvancedOption $myAdvancedOption -ResourcePool $vmhost</pre><p>Creates a virtual machine from a template, specifies a VM anti-affinity rule, and stores the virtual machine on a specified datastore cluster.</p><p class="example-title">--------------  Example 18 --------------</p><pre class="programlisting">$vmhost = Get-VMHost -Name MyVMHost1
$myVM = Get-VM -Name WindowsXP
$mySourceTemplate = Get-Template -Name WindowsTemplate
$myDatastoreCluster = Get-DatastoreCluster -Name MyStorageCluster1
$myAdvancedOption = New-Object &#39;VMware.VimAutomation.ViCore.Types.V1.DatastoreManagement.SdrsVMAntiAffinityRule&#39; $myVM
New-VM -Name VM -Template $mySourceTemplate -Datastore $myDatastoreCluster -AdvancedOption $myAdvancedOption -ResourcePool $vmhost</pre><p>Creates a virtual machine from a template, specifies a VM anti-affinity rule, and stores the virtual machine on a specified datastore cluster.</p><p class="example-title">--------------  Example 19 --------------</p><pre class="programlisting">$mySourceVM = Get-VM -Name MySourceVM1
$myReferenceSnapshot = Get-Snapshot -VM $mySourceVM -Name &quot;InitialState&quot;
$vmhost = Get-VMHost -Name MyVMHost1
$myDatastore = Get-Datastore -Name MyDatastore1
New-VM -Name MyLinkedCloneVM1 -VM $mySourceVM -LinkedClone -ReferenceSnapshot $myReferenceSnapshot -ResourcePool $vmhost -Datastore $myDatastore</pre><p>Creates a linked clone from the specified snapshot of the parent virtual machine. The linked clone is stored to the specified VM host and datastore.</p><p class="example-title">--------------  Example 20 --------------</p><pre class="programlisting">$myCluster = Get-Cluster -Name &quot;MyCluster&quot;
$myVDPortGroup = Get-VDPortgroup -Name &quot;MyVDPortGroup&quot;
$mySharedDatastore = Get-Datastore -Name &quot;MySharedDatastore&quot;
New-VM -Name MyVM -ResourcePool $myCluster -Portgroup $myVDPortGroup -DiskGB 40 -MemoryGB 4 -Datastore $mySharedDatastore</pre><p>Creates a new virtual machine with the specified configuration and connects it to the specified distributed port group.</p></div><hr>Copyright &copy; VMware, Inc.&nbsp;All rights reserved.</body></html>
